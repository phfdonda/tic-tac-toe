#!/usr/bin/env ruby
# frozen_string_literal: true

class Game
  def initialize
    @turn_counter = 0
    @game_ended = false
    @table = Table.new
    @player_1 = Player.new(1)
    @player_2 = Player.new(2)
    @winner = 'Nobody'
    start
  end

  def about
    @game_description = "Tic-Tac-Toe Game
 In this game, wins that who can mark three numbers in a sequence.
 Players take turns to mark the numbers. The first will have X's as marks,
the second will have O's. They can be in diagonal, horizontal or vertical alignment.
If no number can be chosen, and no three numbers in sequence were chosen,
then there's no winner, and the game ends."
  end

  def intro
    pretty_intro
  end

  def start
    turn
  end

  def pretty_intro
    system 'clear'
    puts ' WELCOME! '.center(60, '.')
    sleep 1.0
    puts ' I love that you are here! '.center(60, '.')
    puts ''.center(60, '.')
    sleep 1.0
    puts ' Since you are, how about we play a game? '.center(60, '.')
    sleep 1.0
    puts ' It is called Tic-Tac-Toe. '.center(60, '.')

    puts ' Let the game begin! '.center(60, '.')
  end

  def turn
    @turn_counter += 1

    until @game_ended
      @player = if @turn_counter.odd?
                  @player_1
                else
                  @player_2
                end
      puts "It's #{@player.name}'s turn"
      @move = @player.choice
      @table.mark_choice(@move, @player.mark)
      rules(@move)
    end

    puts "#{winner} won!"
    end

  def rules(_choice)
    @win_row = [[]]
  end
end

class Table
  def initialize
    @options = [%w[1 2 3], %w[4 5 6], %w[7 8 9]]
  end

  def print_table
    @options.each do |element|
      puts element.each { |x| x }.join(' | ')
    end

    def mark_choice(choice, mark)
      @options.map! { |i| i == choice ? i = mark : i }
    end
  end
end

class Player
  def initialize(n_p)
    @@possible_numbers = %w[1 2 3 4 5 6 7 8 9]
    @n_p = n_p
    @n_p == 1 ? @mark = 'X' : 'O'
    player_name
  end

  attr_reader :mark
  attr_reader :choice
  attr_reader :name

  def player_name
    @answer = ''
    if @n_p == 1
      puts "Please, type Player 1's name: "
      @answer = gets.chomp
      while @answer.strip.empty?
        puts "Please, don't leave it blank. Write something."
        @answer = gets.chomp
      end
      @name = @answer
      @@p1_name = @name
      p "Player 1's name is #{@name}"
    elsif @n_p == 2
      puts "Please, type Player 2's name: "
      @answer = gets.chomp
      while @answer.strip.empty? || @answer == @@p1_name
        while @answer.strip.empty?
          puts "Please, don't leave it blank. Write something."
          @answer = gets.chomp
        end
        while @answer == @@p1_name
          puts "This is Player 1's name. Please choose another one."
          @answer = gets.chomp
        end
      end
      @name = @answer
      @@p2_name = @name
      p "Player 2's name is #{@name}"
    end
  end

  def choice
    puts 'Type one of the numbers available to mark your choice'
    @choice = gets.chomp
    until @@possible_numbers.include?(@choice)
      puts 'You must choose a number from 1 to 9 that was still not chosen'
      @choice = gets.chomp
    end
    puts 'Good choice!'
    @@possible_numbers.delete(@choice)
    @choice
  end
end

game = Game.new
